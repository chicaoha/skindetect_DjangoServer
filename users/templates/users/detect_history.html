{% extends 'users/base.html' %}
{% load static %}
{% block title %} History Page {% endblock %}
{% block content %}
<link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
<style>
    #popup-message {
        transition: opacity 0.3s ease;
        opacity: 0;
    }

    #popup-message.show {
        opacity: 1;
        pointer-events: auto;
    }
</style>

<section id="work-process" class="relative z-10 pt-[110px]">
    <div class="container">
        <div class="w-10/12 md:w-7/12 lg:6/12 mx-auto relative pb-20">
            <div class="wow fadeInUp mx-auto mb-10 max-w-[690px] text-center" data-wow-delay=".2s">
                <h2 class="mb-4 text-3xl font-bold text-black dark:text-white sm:text-4xl md:text-[44px] md:leading-tight">
                    Detection History
                </h2>
               
            </div>
            {% if page_objects %}
            {% for data in page_objects %}
            <div class="border-l-2 mt-10">
                {% if data.detect_score <= 50 %}
                    <a href="/aboutDisease?id={{ data.disease_id }}">
                        <div class="transform transition cursor-pointer hover:-translate-y-2 ml-10 relative flex items-center px-6 py-4 bg-green-700 opacity-80 text-white rounded mb-10 flex-col md:flex-row space-y-4 md:space-y-0" >      
                            <!-- Dot Following the Left Vertical Line -->
                            <div class="w-10 h-10 items-center order-1 flex bg-green-600 absolute -left-10 transform -translate-x-2/4 rounded-full z-10 mt-2 md:mt-0">
                                <p class="mx-auto font-semibold text-base text-white text-center">{{ data.detect_score }}%</p>
                            </div>                      
                            <!-- Line that connecting the box with the vertical line -->
                            <div class="w-10 h-1 bg-green-300 absolute -left-10 z-0"></div>
                        
                            <!-- Image column -->
                            <div class="flex-none mr-4 md:mr-0">
                                <img src="/media/{{ data.detect_photo }}" alt="Image" class="w-20 h-20 md:w-24 md:h-24 rounded-xl object-cover object-center border-4 border-white" /> 
                            </div>
                            
                            <!-- Text column -->
                            <div class="flex-auto ml-4 md:ml-8"> <!-- Adjust the margin as needed -->
                                <h1 class="text-xl font-bold">{{ data.detect_result }}</h1>
                                <h3>{{ data.detect_date }}</h3>
                            </div>     
                            <button class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 focus:outline-none focus:bg-green-600 ml-2 delete-button" data-url="{% url 'delete' %}?detect_id={{ data.detect_id }}">Delete</button>
                        </div>   
                    </a> 
                {% elif data.detect_score <= 80 %}
                    <a href="/aboutDisease?id={{ data.disease_id }}">
                        <div class="transform transition cursor-pointer hover:-translate-y-2 ml-10 relative flex items-center px-6 py-4 bg-yellow-700 opacity-80 text-white rounded mb-10 flex-col md:flex-row space-y-4 md:space-y-0">                      
                            <div class="w-10 h-10 items-center order-1 flex bg-yellow-600 absolute -left-10 transform -translate-x-2/4 rounded-full z-10 mt-2 md:mt-0">
                                <p class="mx-auto font-semibold text-base text-white text-center">{{ data.detect_score }}%</p>
                            </div>    

                            <div class="w-10 h-1 bg-yellow-300 absolute -left-10 z-0"></div>
                        
                            <div class="flex-none mr-4 md:mr-0">
                                <img src="/media/{{ data.detect_photo }}" alt="Image" class="w-20 h-20 md:w-24 md:h-24 rounded-xl object-cover object-center border-4 border-white" /> 
                            </div>
                            
                            <div class="flex-auto ml-4 md:ml-8"> <!-- Adjust the margin as needed -->
                                <h1 class="text-xl font-bold">{{ data.detect_result }}</h1>
                                <h3>{{ data.detect_date }}</h3>
                            </div>     
                            <button class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 focus:outline-none focus:bg-yellow-600 ml-2 delete-button" data-url="{% url 'delete' %}?detect_id={{ data.detect_id }}">Delete</button>
                        </div>  
                    </a>
                {% else %}
                    <a href="/aboutDisease?id={{ data.disease_id }}">
                        <div class="transform transition cursor-pointer hover:-translate-y-2 ml-10 relative flex items-center px-6 py-4 bg-red-700 opacity-80 text-white rounded mb-10 flex-col md:flex-row space-y-4 md:space-y-0">                      
                            <!-- Dot Following the Left Vertical Line -->
                            <div class="w-10 h-10 items-center order-1 flex bg-red-600 absolute -left-10 transform -translate-x-2/4 rounded-full z-10 mt-2 md:mt-0">
                                <p class="mx-auto font-semibold text-base text-white text-center">{{ data.detect_score }}%</p>
                            </div>                      
                            <!-- Line that connecting the box with the vertical line -->
                            <div class="w-10 h-1 bg-red-300 absolute -left-10 z-0"></div>
                        
                            <!-- Image column -->
                            <div class="flex-none mr-4 md:mr-0">
                                <img src="/media/{{ data.detect_photo }}" alt="Image" class="w-20 h-20 md:w-24 md:h-24 rounded-xl object-cover object-center border-4 border-white" /> 
                            </div>
                            
                            <!-- Text column -->
                            <div class="flex-auto ml-4 md:ml-8"> <!-- Adjust the margin as needed -->
                                <h1 class="text-xl font-bold">{{ data.detect_result }}</h1>
                                <h3>{{ data.detect_date }}</h3>
                            </div>     
                            <button class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 focus:outline-none focus:bg-red-600 ml-2 delete-button" data-url="{% url 'delete' %}?detect_id={{ data.detect_id }}&page={{ num }}">Delete</button>
                        </div>  
                    </a>
                {% endif %}
            </div>
            {% endfor %}
            {% endif %}

            {% if page_objects.paginator.num_pages > 1 %}
                <div class="flex items-center gap-4">
                    {% if page_objects and page_objects.has_previous %}
                        <a href="?page=1" class="pagination-button flex px-4 py-2 items-center justify-center rounded bg-white text-base font-medium text-black drop-shadow-card hover:bg-primary hover:text-white dark:bg-dark dark:text-white dark:drop-shadow-card-dark dark:hover:bg-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 mr-1">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                            </svg>
                            Previous
                        </a>
                    {% endif %}
                
                    {% if page_objects %}
                        {% for num in page_objects.paginator.page_range %}
                            {% if page_objects.number == num %}
                                <span class="pagination-button flex items-center px-4 py-2 border border-gray-300 rounded-md bg-primary text-white">{{ num }}</span>
                            {% else %}
                                <a href="?page={{ num }}" class="pagination-button flex px-4 py-2 items-center justify-center rounded bg-white text-base font-medium text-black drop-shadow-card hover:bg-primary hover:text-white dark:bg-dark dark:text-white dark:drop-shadow-card-dark dark:hover:bg-primary">{{ num }}</a>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                
                    {% if page_objects and page_objects.has_next %}
                        <a href="?page={{ page_objects.next_page_number }}" class="pagination-button flex px-4 py-2 items-center justify-center rounded bg-white text-base font-medium text-black drop-shadow-card hover:bg-primary hover:text-white dark:bg-dark dark:text-white dark:drop-shadow-card-dark dark:hover:bg-primary">
                            Next
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 ml-1">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                    {% endif %}
                </div>
            {% endif %}

          </div>          
        </div>
    </div>
</section>
{% if result == 'successful' %}
<div id="popup-message" class="fixed bottom-0 left-0 mb-4 ml-4 z-50">
    <div class="max-w-lg w-full flex items-center p-4 text-sm text-green-600 bg-green-500 border border-green-500 rounded-lg shadow-lg dark:bg-gray-800 dark:border-green-800" role="alert">
        <svg class="flex-shrink-0 inline w-6 h-6 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm1-10a1 1 0 0 0-2 0v4a1 1 0 0 0 2 0v-4zm0 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" clip-rule="evenodd"></path>
        </svg>
        <div>
            <span class="font-medium">Delete successfully!</span>
        </div>
    </div>
</div>
{% endif %}
<div id="popup" class="fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex justify-center items-center hidden">
  <div class="bg-white rounded-lg p-8 max-w-md mx-auto">
      <h2 class="text-2xl font-bold mb-4">Delete Confirmation</h2>
      <p>Are you sure you want to delete this detection result?</p>
      <div class="flex justify-end mt-4">
          <button id="cancelButton" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 focus:outline-none focus:bg-gray-400">Cancel</button>
          <a id="confirmButton" href="{% url 'delete' %}?detect_id={{ data.detect_id }}" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 focus:outline-none focus:bg-red-600 ml-2">Confirm Delete</a>
      </div>
  </div>
</div>
<script>
    // Add this script after the form_submitted_successfully check
    var popup = document.getElementById('popup-message');
    if (popup) {
        popup.classList.add('show');
        setTimeout(function() {
            popup.classList.remove('show');
        }, 3000); // Adjust the timeout value (in milliseconds) as needed
    }
</script>

<script>
  function openPopup(event) {
      event.preventDefault();
      document.getElementById('popup').classList.remove('hidden');
      // Get the URL from the data-url attribute of the clicked button
      var deleteUrl = event.target.getAttribute('data-url');
      // Set the href attribute of the confirmation button
      document.getElementById('confirmButton').href = deleteUrl;
  }

  // Attach click event listeners to all delete buttons
  document.querySelectorAll('.delete-button').forEach(button => {
      button.addEventListener('click', openPopup);
  });

  // Add event listener to cancel button
  document.getElementById('cancelButton').addEventListener('click', function () {
      document.getElementById('popup').classList.add('hidden');
  });
</script>


{% endblock %}
