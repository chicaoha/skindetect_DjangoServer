<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% comment %} <link rel="stylesheet" href=""> {% endcomment %}
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="theme-color" content="#ffffff">
        <title>{{ user.email }} Profile</title>
        <link type="text/css" href="./static/css/profile.css" rel="stylesheet">
        {% comment %} <title>Profile</title> {% endcomment %}
        <style>
           #avatar-label {
                display: block; /* Ensure the label takes up the full width */
                text-align: center; /* Center the content horizontally */
    }

            #avatar-preview {
                max-width: 300px;
                max-height: 300px;
                border: 2px solid #ddd;
                border-radius: 50%;
                display: block;
                margin: 0 auto; /* Center the image within the container */
            }     
        </style>
    </head>
    
    {% block body %}
    <body>
        <form method="post" enctype="multipart/form-data"  action="{% url 'profile' %}">
        <main class="content">
            <div class="row">
                <div class="col-12 col-xl-8">
                    <div class="card card-body border-0 shadow mb-4">
                        <h2 class="h5 mb-4">General information</h2>
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div>
                                        <label for="{{ form.first_name.id_for_label }}">First Name</label>
                                        {{ form.first_name }}
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div>
                                        <label for="{{ form.last_name.id_for_label }}">Last Name</label>
                                        {{ form.last_name }}
                                    </div>
                                </div>
                            </div>
                            <div class="row align-items-center">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.dob.id_for_label }}">Date of Birth:</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                    d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </span>
                                        {{ form.dob }}
                                        {% comment %} <input data-datepicker="" class="form-control" id="birthday"  {% endcomment %}
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.gender.id_for_label }}">Gender</label>
                                    {{ form.gender }}
                                </div>                                
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="form-group">
                                        <label for="{{ form.email.id_for_label }}">Email</label>
                                        {{ form.email }}
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-group">
                                        <label for="{{ form.phone.id_for_label }}">Phone</label>
                                        {{ form.phone }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-9 mb-3">
                                    <div class="form-group">
                                        <label for="{{ form.address.id_for_label }}">Address</label>
                                        {{ form.address }}
                                    </div>
                                </div>
                            </div>
                
                            <div class="mt-3">
                                <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save all</button>
                            </div>
                        {% comment %} </form> {% endcomment %}
                    </div>
                </div>
                <div class="col-12 col-xl-4">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card shadow border-0 text-center p-0">
                                <div class="profile-cover rounded-top">
                                </div>
                                <div class="card-body pb-5">
                                    <label for="{{ form.avatar.id_for_label }}" id="avatar-label">
                                        <input type="file" name="{{ form.avatar.name }}" id="{{ form.avatar.id_for_label }}"
                                               accept="image/*" hidden onchange="loadFile(this)" id='file' value="{{ form.update_avatar.value }}">
                                        <input type="hidden" name="{{ form.update_avatar.name }}" value="{{ form.update_avatar.value }}">
                                        <img src="{{ profile.avatar.url }}" alt="Avatar" id="avatar-preview" class="avatar-preview mx-auto mt-n7 mb-4">
                                        <!-- Add your custom styling for the file input -->
                                        {% comment %} <div class="custom-file">
                                            <label class="custom-file-label" for="{{ form.avatar.id_for_label }}"></label>
                                        </div> {% endcomment %}
                                    </label>                                    
                                    <h4 class="h3" id='fullName'></h4>
                                    <h5 class="fw-normal" id='age'></h5>
                                </div>
                        <script type="text/javascript">

                            (function (d, m) {
                                var kommunicateSettings =
                                {
                                    "appId": "e8bdb391eea372af0219e3329ba92e89",
                                    "popupWidget": true,
                                    "automaticChatOpenOnNavigation": true
                                };
                                var s = document.createElement("script");
                                s.type = "text/javascript"; s.async = true;
                                s.src = "https://widget.kommunicate.io/v2/kommunicate.app";
                                var h = document.getElementsByTagName("head")[0];
                                h.appendChild(s);
                                window.kommunicate = m;
                                m._globals = kommunicateSettings;
                            })(document, window.kommunicate || {});
                            /* NOTE : Use web server to view HTML files as real-time update will not work if you directly open the HTML file in the browser. */
                        </script>
                    </div>
                </div>
            </div>
            <div class="theme-settings card bg-gray-800 pt-2 collapse" id="theme-settings">
                <div class="card-body bg-gray-800 text-white pt-4">
                    <button type="button" class="btn-close theme-settings-close" aria-label="Close"
                        data-bs-toggle="collapse" href="#theme-settings" role="button" aria-expanded="false"
                        aria-controls="theme-settings"></button>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="m-0 mb-1 me-4 fs-7">Open source <span role="img" aria-label="gratitude">ðŸ’›</span></p>
                        <a class="github-button" href="https://github.com/themesberg/volt-bootstrap-5-dashboard"
                            data-color-scheme="no-preference: dark; light: light; dark: light;" data-icon="octicon-star"
                            data-size="large" data-show-count="true"
                            aria-label="Star themesberg/volt-bootstrap-5-dashboard on GitHub">Star</a>
                    </div>
                    <a href="https://themesberg.com/product/admin-dashboard/volt-bootstrap-5-dashboard" target="_blank"
                        class="btn btn-secondary d-inline-flex align-items-center justify-content-center mb-3 w-100">
                        Download
                        <svg class="icon icon-xs ms-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M2 9.5A3.5 3.5 0 005.5 13H9v2.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 15.586V13h2.5a4.5 4.5 0 10-.616-8.958 4.002 4.002 0 10-7.753 1.977A3.5 3.5 0 002 9.5zm9 3.5H9V8a1 1 0 012 0v5z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </a>
                    <p class="fs-7 text-gray-300 text-center">Available in the following technologies:</p>
                    <div class="d-flex justify-content-center">
                        <a class="me-3" href="https://themesberg.com/product/admin-dashboard/volt-bootstrap-5-dashboard"
                            target="_blank">
                            <img src="../assets/img/technologies/bootstrap-5-logo.svg" class="image image-xs">
                        </a>
                        <a href="https://demo.themesberg.com/volt-react-dashboard/#/" target="_blank">
                            <img src="../assets/img/technologies/react-logo.svg" class="image image-xs">
                        </a>
                    </div>
                </div>
            </div>
    
            <div class="card theme-settings bg-gray-800 theme-settings-expand" id="theme-settings-expand">
                <div class="card-body bg-gray-800 text-white rounded-top p-3 py-2">
                    <span class="fw-bold d-inline-flex align-items-center h6">
                        <svg class="icon icon-xs me-2" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"
                                clip-rule="evenodd"></path>
                        </svg>
                        Settings
                    </span>
                </div>
            </div>
        </main>
    </form>
    </body>
    {% endblock %}
</html>

<script>
    // Function to update the avatar preview
    var loadFile = function (event) {
      var output = document.getElementById('avatar-preview');
      console.log(output);
      output.src = URL.createObjectURL(event.files[0]);
      output.onload = function () {
          URL.revokeObjectURL(output.src) // free memory
      }
    };

  var fname = document.getElementById('id_first_name');
  var lname = document.getElementById('id_last_name');


  var firstName = fname.value;
  var lastName = lname.value;
  var fullName = firstName + " " + lastName;

  document.getElementById('fullName').innerHTML = fullName;

  function calculateAge() {
    // Get the value from the input field
    var birthdayInput = document.getElementById("id_dob");
    var birthdayValue = birthdayInput.value;
    if(birthdayValue){
    // Parse the date string to a JavaScript Date object
    var parts = birthdayValue.split("-");
    
    // Calculate the age
    var currentYear = new Date().getFullYear();
    var age = currentYear - parts[0];
    }
    return age;
}
    console.log(calculateAge())
    if(calculateAge()){
    document.getElementById('age').innerHTML = 'Age: ' + calculateAge();
    }
  </script>